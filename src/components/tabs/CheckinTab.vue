<template>
  <div class="why-pill" @click="showWhyModal = true">
    <span class="pill-icon">ğŸ’¡</span>
    <span class="pill-text">æ¸©æŸ”æç¤ºï¼šä¸ºä»€ä¹ˆè¦è®°å½•ï¼Ÿ è¯·ç‚¹å‡»</span>
    <span class="pill-arrow">â†’</span>
  </div>
  <div v-if="showWhyModal" class="modal-backdrop">
  <div class="modal-card">
    <h2 class="modal-title">ä¸ºä»€ä¹ˆè¦è®°å½•ï¼Ÿ</h2>
    <div class="modal-body">
      <p>
        æˆ‘ä»¬æœ‰ç‚¹åƒ F1 èµ›è½¦æ‰‹ï¼šåªæœ‰å‡ºäº†å¤§äº‹æ•…ï¼Œæ‰ä¼šè¿›ä¸€æ¬¡ç»´ä¿®åŒºï¼ˆä½é™¢ã€æ‰‹æœ¯ï¼‰ï¼Œä½†ç»å¤§å¤šæ•°æ—¶é—´ï¼Œè½¦æ˜¯åœ¨èµ›é“ä¸Šè·‘çš„â€”â€”é‚£æ®µæ—¶é—´åªèƒ½é æˆ‘ä»¬è‡ªå·±ã€‚
      </p>
      <p>
        è®°å½•ï¼Œä¸æ˜¯ä¸ºäº†å“è‡ªå·±ï¼Œä¹Ÿä¸æ˜¯å› ä¸ºä½ å¾ˆä¸¥é‡ï¼Œè€Œæ˜¯å¸®æˆ‘ä»¬ææ¸…æ¥šï¼š
        <strong>å¹³æ—¶æ€ä¹ˆå¼€è½¦æ›´å®‰å…¨ã€å‡ºé—®é¢˜å‰æœ‰å“ªäº›é¢„å…†</strong>ã€‚
      </p>
      <p>
        å¾ˆå¤šå‹‡å£«è®°å½•çš„æ—¶å€™ä¼šè§‰å¾—ã€Œè‡ªå·±çŠ¶æ€å¥½å·®ã€ï¼Œä½†å®é™…å¤æŸ¥ã€è‚ é•œçš„ç»“æœå¾€å¾€æ¯”æƒ³è±¡å¥½å¾—å¤šã€‚è®°å½•åªæ˜¯è®©åŒ»ç”Ÿæ›´äº†è§£ä½ ï¼Œä¹Ÿè®©ä½ ä»¥åå›å¤´çœ‹çš„æ—¶å€™ï¼ŒçŸ¥é“ï¼š
        <strong>åŸæ¥å·²ç»è¿‡äº†è¿™ä¹ˆå¤šå¤©äº†å•Šï¼Œè¿™äº›å¤©é‡Œèº«ä½“å’Œç”Ÿæ´»æ˜¯æ€ä¹ˆä¸€æ­¥æ­¥å˜å¥½çš„ğŸ’ª</strong>ã€‚
      </p>
      <p>
        æˆ‘ç›¸ä¿¡ï¼Œéšç€é¢„é˜² + æ²»ç–—æ…¢æ…¢åˆ°ä½ï¼Œä½ çš„è®°å½•ä¼šè¶Šæ¥è¶Šè½»æ¾ã€è¶Šæ¥è¶Šç®€å•ï¼Œç”Ÿæ´»ä¹Ÿä¼šè¶Šæ¥è¶Šåƒä½ è‡ªå·±æƒ³è¦çš„æ ·å­ã€‚
      </p>
      <p> ğŸ‘‘ çš‡å† ç»™ä½ å¸¦å¥½,åˆ«ä½å¤´ï¼
      </p>
    </div>
    <button class="modal-close" @click="showWhyModal = false">
      æˆ‘çŸ¥é“å•¦
    </button>
  </div>
</div>
  <!-- æ˜Ÿå…‰æ‰“å¡æ¨¡å— -->
  <main class="grid">
    <!-- ä»Šæ—¥æ¦‚è§ˆ -->
    <section class="card overview-card">
      <div class="card-header">
        <h2>ä»Šæ—¥æ¦‚è§ˆ</h2>
        <span class="chip chip-soft">æ¢å¤æœŸ Â· ç¬¬ 21 å¤©</span>
      </div>

      <div class="overview-content">
        <div class="ring">
          <div class="ring-inner">
            <span class="ring-value">{{ overallScore }}%</span>
            <span class="ring-label">ä»Šæ—¥æ€»ä½“çŠ¶æ€</span>
          </div>
        </div>

        <div class="overview-metrics">
          <div class="metric" v-for="m in metrics" :key="m.label">
            <div class="metric-top">
              <span class="dot" :style="{ background: m.color }"></span>
              <span class="metric-label">{{ m.label }}</span>
              <span class="metric-score">{{ m.value }}/10</span>
            </div>
            <div class="metric-bar">
              <div
                  class="metric-bar-fill"
                  :style="{ width: m.value * 10 + '%', background: m.color }"
              ></div>
            </div>
            <p class="metric-note">{{ m.note }}</p>
          </div>
        </div>
      </div>
    </section>

    <!-- ç—‡çŠ¶è¶‹åŠ¿ -->
    <section class="card chart-card">
      <div class="card-header">
        <h2>æœ€è¿‘ 7 å¤©ç—›æ„Ÿè¶‹åŠ¿</h2>
        <span class="chip">0 = ä¸ç—› Â· 10 = çˆ†ç‚¸ç—›</span>
      </div>
      <div class="chart-placeholder">
        <svg viewBox="0 0 200 80" class="mini-chart">
          <polyline
              fill="none"
              stroke="#4ade80"
              stroke-width="2"
              :points="painPolyline"
          />
          <circle
              v-for="(p, idx) in painData"
              :key="idx"
              :cx="(idx / (painData.length - 1)) * 190 + 5"
              :cy="80 - p * 7"
              r="2.5"
              class="chart-point"
          />
        </svg>
        <div class="chart-x-axis">
          <span v-for="(d, idx) in days" :key="idx">{{ d }}</span>
        </div>
      </div>
    </section>

    <!-- ä»Šæ—¥å°ä»»åŠ¡ -->
    <section class="card goals-card">
      <div class="card-header">
        <h2>ä»Šæ—¥ä»»åŠ¡</h2>
        <span class="chip chip-soft">è½»é‡æ¨¡å¼</span>
      </div>
      <div class="goals-list">
        <article class="goal-card success">
          <p class="goal-title">æŒ‰æ—¶ç”¨è¯</p>
          <p class="goal-sub">ä¹Œå¸•æ›¿å°¼ Â· 45mg</p>
          <div class="goal-progress">
            <div class="goal-bar">
              <div class="goal-bar-fill" style="width: 66%;"></div>
            </div>
            <span class="goal-tag">ä»Šå¤©å®Œæˆ 2 / 3 æ¬¡</span>
          </div>
        </article>

        <article class="goal-card warning">
          <p class="goal-title">è¥å…»æ¶²æ‘„å…¥</p>
          <p class="goal-sub">ä»Šå¤©è¿˜å·®ä¸€é¡¿ Â· æ”¾è½»æ¾æ…¢æ…¢å–</p>
          <span class="goal-tag">å°å£å– Â· èƒƒæ›´èˆ’æœ</span>
        </article>

        <article class="goal-card calm">
          <p class="goal-title">æƒ…ç»ª & æ¸¸æˆæ—¶é—´</p>
          <p class="goal-sub">ä»Šæ™šå°‘æ‰“ä¸€æŠŠï¼Œå°±ç®—èµ¢</p>
          <span class="goal-tag">ç•™ä¸€ç‚¹ç²¾åŠ›ç»™ã€Œçˆ±ä¸åˆ›é€ ã€</span>
        </article>
      </div>
    </section>

    <!-- ç”¨è¯å¡ç‰‡ -->
    <section class="card meds-card">
      <div class="card-header">
        <h2>ä»Šæ—¥ç”¨è¯æ‰“å¡</h2>
        <span class="chip">ä»…è‡ªå·±å¯è§</span>
      </div>
      <div class="meds-grid">
        <div
            v-for="slot in medSlots"
            :key="slot.time"
            class="med-slot"
            :class="{ done: slot.done }"
        >
          <div class="med-time">{{ slot.time }}</div>
          <div class="med-name">{{ slot.name }}</div>
          <div class="med-status">
            <span v-if="slot.done">âœ… å·²å®Œæˆ</span>
            <span v-else>ğŸ•’ å¾…æœç”¨</span>
          </div>
        </div>
      </div>
    </section>
    <!-- é¥®é£Ÿ & è§¦å‘å› ç´  -->
    <section class="card food-card">
      <div class="card-header">
        <h2>é¥®é£Ÿ & è§¦å‘å› ç´ </h2>
        <span class="chip chip-soft">ä»Šå¤©å°½é‡ã€Œæ¸…æ·¡ + å¯æ¶ˆåŒ–ã€</span>
      </div>
      <ul class="food-list">
        <li class="food-item">
          <div>
            <p class="food-title">è¥å…»æ¶² Â· ä¸»é£Ÿ</p>
            <p class="food-note">å·²å– 2 / 3 æ¬¡ Â· ä¸‹æ¬¡ 16:30 å·¦å³</p>
          </div>
          <span class="food-tag good">å¯</span>
        </li>
        <li class="food-item">
          <div>
            <p class="food-title">æ²¹ç‚¸ / çƒ§çƒ¤ Â· ç›´æ¥ ban æ‰</p>
            <p class="food-note">æœ€è¿‘ 20 å¤©å›é¿æˆåŠŸ âœ…</p>
          </div>
          <span class="food-tag danger">ç¦</span>
        </li>
        <li class="food-item">
          <div>
            <p class="food-title">å°å°å¿ƒæ„¿æ¸…å•</p>
            <p class="food-note">
              æºƒç–¡ç¼©å°åï¼šä¸€ç¢—é¡ºæ»‘çš„é¢ + ä¸€æ¬¡å®‰å¿ƒçš„ç«é”…
            </p>
          </div>
          <span class="food-tag wish">æ„¿</span>
        </li>
      </ul>
    </section>

    <!-- å¿ƒæƒ… & èƒ½é‡ -->
    <section class="card mood-card">
      <div class="card-header">
        <h2>ä»Šæ—¥å¿ƒæƒ… & ç”µé‡</h2>
        <span class="chip">è‡ªå·±ç»™è‡ªå·±æ‰“ä¸ªåˆ†</span>
      </div>
      <div class="mood-body">
        <div class="battery">
          <div class="battery-shell">
            <div class="battery-level" :style="{ width: energy + '%' }"></div>
          </div>
          <p class="battery-label">å½“å‰ç”µé‡ï¼š{{ energy }}%</p>
        </div>
        <div class="tags">
          <span class="pill">æœ‰ç‚¹å›°ä½†è¿˜èƒ½å¹²äº‹</span>
          <span class="pill">ä¸æ˜¯åºŸç‰© Â· æ˜¯åœ¨ç¼“å†²</span>
          <span class="pill">ä»Šå¤©åªè¦åšä¸€å°æ­¥å°±åˆæ ¼</span>
        </div>
      </div>
    </section>
  </main>
</template>
<script setup>
// å‡æ•°æ®ï¼šç—›æ„Ÿ 0â€“10
import {computed, ref} from "vue";
const showWhyModal = ref(false)
const painData = [4, 5, 3, 6, 5, 4, 3]
const days = ['ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­', 'ä»Š']

const painPolyline = computed(() =>
    painData
        .map((p, idx) => {
          const x = (idx / (painData.length - 1)) * 190 + 5
          const y = 80 - p * 7
          return `${x},${y}`
        })
        .join(' ')
)

// å„ç»´åº¦åˆ†æ•°
const metrics = [
  { label: 'è…¹ç—›æ§åˆ¶', value: 7, note: 'å¤šä¸ºéšç—›ï¼Œå¯å¿å—', color: '#4ade80' },
  { label: 'æ’ä¾¿æƒ…å†µ', value: 6, note: 'åŸºæœ¬ç¨³å®šï¼Œç•¥é¢‘ç¹', color: '#22d3ee' },
  { label: 'ç¡çœ è´¨é‡', value: 8, note: 'æ˜¨æ™šå…¥ç¡ä¸é”™', color: '#a855f7' },
  { label: 'æƒ…ç»ª & ç„¦è™‘', value: 5, note: 'æœ‰ç‚¹ä¹±ï¼Œä½†æ²¡å¤±æ§', color: '#fb923c' }
]

const overallScore = Math.round(
    (metrics.reduce((sum, m) => sum + m.value, 0) / metrics.length) * 10
)

// ç”¨è¯æ—¶æ®µ
const medSlots = [
  { time: 'æ—©ä¸Š', name: 'ä¹Œå¸•æ›¿å°¼ 45mg', done: true },
  { time: 'ä¸­åˆ', name: 'è¥å…»æ¶² 1 è¢‹', done: true },
  { time: 'æ™šä¸Š', name: 'è¥å…»æ¶² 1 è¢‹ + å¤æŸ¥æé†’', done: false }
]

// ä»Šæ—¥ç”µé‡ï¼ˆä½ å¯ä»¥ä¹‹åä»æ‰“å¡é‡Œç®—ï¼‰
const energy = 42
</script>
<style scoped>
/* é€šç”¨å¡ç‰‡ */
.grid {
  display: grid;
  grid-template-columns: 2.1fr 1.7fr 1.6fr;
  grid-auto-rows: minmax(0, auto);
  gap: 18px;
}


.chip {
  padding: 4px 10px;
  border-radius: 999px;
  font-size: 11px;
  color: #e5e7eb;
  background: rgba(31, 41, 55, 0.9);
}

.chip-soft {
  background: rgba(22, 163, 74, 0.18);
  color: #bbf7d0;
}


/* ä»Šæ—¥æ¦‚è§ˆ */
.overview-card {
  grid-column: span 2;
}

.overview-content {
  display: grid;
  grid-template-columns: 180px 1fr;
  gap: 18px;
  align-items: center;
}

.ring {
  width: 160px;
  height: 160px;
  border-radius: 999px;
  background: conic-gradient(#22c55e 0 240deg, #1f2937 240deg 360deg);
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
}

.ring::after {
  content: '';
  position: absolute;
  inset: 10px;
  border-radius: inherit;
  background: radial-gradient(circle at top, #020617, #020617 60%, #111827);
}

.ring-inner {
  position: relative;
  text-align: center;
}

.ring-value {
  font-size: 24px;
  font-weight: 700;
}

.ring-label {
  display: block;
  font-size: 12px;
  color: #9ca3af;
  margin-top: 4px;
}

.overview-metrics {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 10px;
}

.metric {
  padding: 8px 10px;
  border-radius: 12px;
  background: rgba(15, 23, 42, 0.9);
  border: 1px solid rgba(55, 65, 81, 0.9);
}

.metric-top {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 12px;
}

.metric-label {
  flex: 1;
}

.metric-score {
  font-weight: 600;
}

.dot {
  width: 6px;
  height: 6px;
  border-radius: 999px;
}

.metric-bar {
  margin-top: 6px;
  width: 100%;
  height: 4px;
  border-radius: 999px;
  background: #020617;
  overflow: hidden;
}

.metric-bar-fill {
  height: 100%;
  border-radius: inherit;
}

.metric-note {
  margin-top: 4px;
  font-size: 11px;
  color: #9ca3af;
}

/* ç—‡çŠ¶è¶‹åŠ¿ */
.chart-card {
  grid-column: span 1;
}

.chart-placeholder {
  margin-top: 4px;
}

.mini-chart {
  width: 100%;
  height: 80px;
}

.chart-point {
  fill: #bbf7d0;
}

.chart-x-axis {
  margin-top: 4px;
  display: flex;
  justify-content: space-between;
  font-size: 11px;
  color: #6b7280;
}

/* ä»Šæ—¥ä»»åŠ¡ */
.goals-card {
  grid-column: span 1;
}

.goals-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.goal-card {
  border-radius: 12px;
  padding: 10px 12px;
  background: rgba(17, 24, 39, 0.95);
  border: 1px solid rgba(55, 65, 81, 0.9);
  font-size: 13px;
}

.goal-title {
  font-weight: 600;
}

.goal-sub {
  font-size: 12px;
  color: #9ca3af;
  margin-top: 2px;
}

.goal-progress {
  margin-top: 6px;
}

.goal-bar {
  height: 4px;
  border-radius: 999px;
  background: #020617;
  overflow: hidden;
}

.goal-bar-fill {
  height: 100%;
  border-radius: inherit;
  background: linear-gradient(90deg, #22c55e, #a3e635);
}

.goal-tag {
  display: inline-block;
  margin-top: 4px;
  font-size: 11px;
  color: #bbf7d0;
}

.goal-card.success {
  border-color: rgba(34, 197, 94, 0.6);
}

.goal-card.warning {
  border-color: rgba(250, 204, 21, 0.6);
}

.goal-card.calm {
  border-color: rgba(129, 140, 248, 0.6);
}

/* ç”¨è¯ */
.meds-card {
  grid-column: span 1;
}

.meds-grid {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 8px;
}

.med-slot {
  border-radius: 12px;
  padding: 8px 10px;
  background: rgba(15, 23, 42, 0.95);
  border: 1px solid rgba(55, 65, 81, 0.9);
  font-size: 12px;
}

.med-slot.done {
  border-color: rgba(34, 197, 94, 0.7);
  background: rgba(22, 163, 74, 0.12);
}

.med-time {
  font-weight: 600;
  margin-bottom: 2px;
}

.med-name {
  color: #9ca3af;
  margin-bottom: 4px;
}

.med-status span {
  font-size: 11px;
}

/* é¥®é£Ÿå¡ç‰‡ */
.food-card {
  grid-column: span 1;
}

.food-list {
  list-style: none;
  padding: 0;
  margin: 0;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.food-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 8px;
  padding: 8px 10px;
  border-radius: 12px;
  background: rgba(15, 23, 42, 0.95);
  border: 1px solid rgba(55, 65, 81, 0.9);
}

.food-title {
  font-size: 13px;
  font-weight: 500;
}

.food-note {
  font-size: 11px;
  color: #9ca3af;
}

.food-tag {
  width: 22px;
  height: 22px;
  border-radius: 999px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 11px;
  font-weight: 700;
}

.food-tag.good {
  background: rgba(34, 197, 94, 0.16);
  color: #bbf7d0;
}

.food-tag.danger {
  background: rgba(248, 113, 113, 0.16);
  color: #fecaca;
}

.food-tag.wish {
  background: rgba(129, 140, 248, 0.16);
  color: #e0e7ff;
}

/* å¿ƒæƒ… */
.mood-card {
  grid-column: span 1;
}

.mood-body {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.battery-shell {
  position: relative;
  width: 100%;
  height: 16px;
  border-radius: 999px;
  background: #020617;
  overflow: hidden;
  border: 1px solid rgba(55, 65, 81, 0.9);
}

.battery-level {
  height: 100%;
  background: linear-gradient(90deg, #f97316, #22c55e);
  border-radius: inherit;
}

.battery-label {
  margin-top: 4px;
  font-size: 12px;
  color: #e5e7eb;
}

.tags {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}

.pill {
  padding: 4px 8px;
  border-radius: 999px;
  font-size: 11px;
  background: rgba(31, 41, 55, 0.9);
  color: #e5e7eb;
}

/* å“åº”å¼ */
@media (max-width: 1024px) {
  .grid {
    grid-template-columns: 1fr;
  }
  .overview-card {
    grid-column: span 1;
  }
}
.why-pill {
  /* æ ¸å¿ƒï¼šä¸å†æ˜¯é€šæ ï¼Œè€Œæ˜¯è‡ªé€‚åº”å®½åº¦ï¼Œå±…ä¸­ */
  display: inline-flex;
  align-items: center;
  gap: 8px;
  margin: 0 auto 14px auto; /* å±…ä¸­æ˜¾ç¤º */
  padding: 8px 16px;
  border-radius: 999px; /* èƒ¶å›Šå½¢çŠ¶ */

  /* é¢œè‰²ï¼šæ·±è‰²èƒŒæ™¯ï¼Œä½†æ›´èåˆï¼Œä½¿ç”¨å¾®å¼±çš„æš–å…‰ */
  background: rgba(248, 181, 82, 0.08); /* ææ·¡çš„æ©™è‰²èƒŒæ™¯ */
  border: 1px solid rgba(248, 181, 82, 0.2); /* å¾®å¼±çš„è¾¹æ¡† */
  color: #fed7aa; /* æš–è‰²æ–‡å­— */

  font-size: 13px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease;
  backdrop-filter: blur(5px); /*ç¨å¾®å¸¦ç‚¹æ¯›ç»ç’ƒå¢å¼ºè´¨æ„Ÿ*/
}

.why-pill:hover {
  background: rgba(248, 181, 82, 0.15);
  border-color: rgba(248, 181, 82, 0.4);
  transform: translateY(-1px);
}

.pill-icon {
  font-size: 14px;
}

.pill-arrow {
  font-size: 14px;
  opacity: 0.6;
  margin-left: 4px;
  transition: transform 0.2s;
}

.why-pill:hover .pill-arrow {
  transform: translateX(3px); /* hoveræ—¶ç®­å¤´æœ‰ä¸ªå°ä½ç§» */
}
/* æš–è‰²å¼¹çª— */
.modal-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(15, 23, 42, 0.78);
  backdrop-filter: blur(10px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 40;
}

.modal-card {
  width: min(420px, 90vw);
  border-radius: 18px;
  padding: 18px 18px 14px;
  background: radial-gradient(circle at top, #fff7ed, #fee2e2);
  color: #3f3f46;
  box-shadow: 0 25px 55px rgba(0, 0, 0, 0.55);
}

.modal-title {
  font-size: 16px;
  font-weight: 700;
  margin-bottom: 10px;
  color: #7c2d12;
}

.modal-body {
  font-size: 13px;
  line-height: 1.6;
}

.modal-body p + p {
  margin-top: 6px;
}

.modal-close {
  margin-top: 10px;
  border: none;
  cursor: pointer;
  padding: 6px 12px;
  border-radius: 999px;
  font-size: 13px;
  background: #f97316;
  color: #fff7ed;
  float: right;
}

.search-box input {
  border: none;
  background: transparent;
  color: #e5e7eb;
  outline: none;
  font-size: 13px;
}

.search-box i {
  font-size: 16px;
  color: #6b7280;
}

.user-info .name {
  font-size: 13px;
  font-weight: 600;
}

.user-info .tag {
  font-size: 11px;
  color: #9ca3af;
}

.tab-item i {
  font-size: 16px;
}

.card {
  background: rgba(15, 23, 42, 0.95);
  border-radius: 18px;
  padding: 16px 18px;
  border: 1px solid rgba(148, 163, 184, 0.25);
  box-shadow: 0 18px 35px rgba(0, 0, 0, 0.4);
}

.card-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 12px;
}

.card-header h2 {
  font-size: 15px;
  font-weight: 600;
}
/* å¦‚æœä½ çš„ InsuranceMap ç»„ä»¶é‡Œæ²¡æœ‰å®šé«˜åº¦ï¼Œè¿™é‡Œå¯ä»¥å¼ºè¡Œå®šä¸€ä¸‹ */
/* :deep() æ˜¯ Vue çš„ä¸€ç§ç©¿é€å†™æ³•ï¼Œå¯ä»¥å½±å“å­ç»„ä»¶çš„æ ·å¼ */
:deep(.echarts-map) {
  width: 100% !important;
  height: 100% !important;
  min-height: 500px;
}

</style>